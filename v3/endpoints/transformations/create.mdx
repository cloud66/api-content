---
title: Create Transformation
scope: redeploy
path: /stacks/:stack_id/formations/:formation_id/transformations
method: POST
response: |
  {
    "response": {
      "uid": "transformation-789-ghi",
      "name": "security-hardening",
      "sequence": 3,
      "formation_uid": "formation-456-def",
      "body": "filters:\n  - match:\n      kind: Deployment\n      metadata:\n        labels:\n          security: required\ntransforms:\n  - op: replace\n    path: /spec/template/spec/securityContext\n    value:\n      runAsNonRoot: true\n      runAsUser: 1000\n      fsGroup: 2000\n  - op: add\n    path: /spec/template/spec/containers/0/securityContext\n    value:\n      allowPrivilegeEscalation: false\n      readOnlyRootFilesystem: true\n      capabilities:\n        drop:\n          - ALL",
      "version": "1.0.0",
      "tags": ["security", "hardening"],
      "created_at": "2025-01-15T18:30:00Z",
      "updated_at": "2025-01-15T18:30:00Z"
    }
  }
request_body: |
  {
    "message": "Add security hardening transformation for sensitive workloads",
    "transformation": {
      "name": "security-hardening",
      "sequence": 3,
      "body": "filters:\n  - match:\n      kind: Deployment\n      metadata:\n        labels:\n          security: required\ntransforms:\n  - op: replace\n    path: /spec/template/spec/securityContext\n    value:\n      runAsNonRoot: true\n      runAsUser: 1000\n      fsGroup: 2000\n  - op: add\n    path: /spec/template/spec/containers/0/securityContext\n    value:\n      allowPrivilegeEscalation: false\n      readOnlyRootFilesystem: true\n      capabilities:\n        drop:\n          - ALL",
      "tags": ["security", "hardening"]
    }
  }
parameters:
  - name: stack_id
    in: path
    required: true
    type: string
    description: Stack UID
  - name: formation_id
    in: path
    required: true
    type: string
    description: Formation UID
  - name: message
    in: body
    required: true
    type: string
    description: Commit message describing the transformation creation
  - name: transformation
    in: body
    required: true
    type: object
    description: Transformation configuration
    properties:
      name:
        type: string
        description: Unique transformation name within the formation
      sequence:
        type: integer
        description: Execution order (lower numbers execute first)
      body:
        type: string
        description: YAML transformation rules with filters and transforms
      tags:
        type: array
        description: Optional tags for transformation organization
        items:
          type: string
---

Creates a new formation transformation for dynamic deployment customization.

Creates a transformation that modifies formations during deployment based on filters and rules. Transformations enable environment-specific configurations and deployment customizations without modifying source manifests.

<Callout type="warning" title="Feature Flag Required">
This endpoint requires the formations feature flag to be enabled on your account. Contact support@cloud66.com if this feature is not available.
</Callout>

<RelatedModels models={['Transformation', 'Formation', 'Stack']} />

**Transformation Requirements:**
- **Unique Name**: Transformation name must be unique within the formation
- **Valid YAML**: Transformation body must contain valid YAML filters and transforms
- **Sequence Order**: Lower sequence numbers execute first during deployment
- **Version Control**: All transformation changes are tracked with commit messages

<Callout type="info" title="Permission Required">
You must have transformation create rights on the formation to create new transformations.
</Callout>

**Transformation Structure:**
The transformation body should follow this YAML structure:
```yaml
filters:
  - match:
      kind: ResourceType
      metadata:
        labels:
          key: value
transforms:
  - op: operation
    path: /path/to/field
    value: new_value
```

**Available Operations:**
- **replace**: Replace existing values at the specified path
- **add**: Add new fields or append to arrays
- **remove**: Delete fields or array elements
- **copy**: Copy values from one path to another
- **move**: Move values between paths
- **test**: Validate values before applying other operations

**Common Use Cases:**
- **Environment Variables**: Set environment-specific configurations
- **Resource Limits**: Apply resource constraints based on environment
- **Security Contexts**: Enforce security policies and contexts
- **Service Configuration**: Modify service types and networking
- **Scaling Parameters**: Set replica counts and scaling policies

**Sequence Guidelines:**
- **1-10**: Infrastructure and base configuration transformations
- **11-20**: Security and compliance transformations
- **21-30**: Application-specific transformations
- **31+**: Post-processing and finalization transformations

<ResponseCodes 
  codes={[200, 400, 401, 403, 422]}
  overrides={{
    200: "Success - Transformation created successfully",
    400: "Bad Request - Invalid transformation configuration or parameters",
    403: "Forbidden - OAuth token lacks required `redeploy` scope or insufficient transformation create rights",
    422: "Unprocessable Entity - Validation errors in transformation configuration"
  }}
/>
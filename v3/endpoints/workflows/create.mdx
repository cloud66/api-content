---
title: Create Workflow
scope: redeploy
path: /stacks/:stack_id/formations/:formation_id/workflows
method: POST
response: |
  {
    "response": {
      "uid": "workflow-789-ghi",
      "name": "hotfix-deploy",
      "formation_uid": "formation-456-def",
      "default": false,
      "body": "steps:\n  - name: build\n    type: build_step\n    config:\n      dockerfile: Dockerfile.hotfix\n      context: .\n  - name: fast-deploy\n    type: deploy_step\n    config:\n      strategy: recreate\n      skip_health_check: false",
      "version": "1.0.0",
      "tags": ["hotfix", "emergency"],
      "created_at": "2025-01-15T20:30:00Z",
      "updated_at": "2025-01-15T20:30:00Z"
    }
  }
request_body: |
  {
    "message": "Add hotfix deployment workflow for emergency releases",
    "workflow": {
      "name": "hotfix-deploy",
      "default": false,
      "body": "steps:\n  - name: build\n    type: build_step\n    config:\n      dockerfile: Dockerfile.hotfix\n      context: .\n  - name: fast-deploy\n    type: deploy_step\n    config:\n      strategy: recreate\n      skip_health_check: false",
      "tags": ["hotfix", "emergency"]
    }
  }
parameters:
  - name: stack_id
    in: path
    required: true
    type: string
    description: Stack UID
  - name: formation_id
    in: path
    required: true
    type: string
    description: Formation UID
  - name: message
    in: body
    required: true
    type: string
    description: Commit message describing the workflow creation
  - name: workflow
    in: body
    required: true
    type: object
    description: Workflow configuration
    properties:
      name:
        type: string
        description: Unique workflow name within the formation
      default:
        type: boolean
        description: Whether this workflow should be the formation's default
      body:
        type: string
        description: YAML workflow configuration defining steps and execution
      tags:
        type: array
        description: Optional tags for workflow organization
        items:
          type: string
---

Creates a new deployment workflow for the specified formation.

Creates a workflow that defines automated sequences of deployment and operational tasks. Workflows control how deployments are executed and can be customized for different environments and scenarios.

<Callout type="warning" title="Feature Flag Required">
This endpoint requires the formations feature flag to be enabled on your account. Contact support@cloud66.com if this feature is not available.
</Callout>

<RelatedModels models={['Workflow', 'Formation', 'Stack']} />

**Workflow Requirements:**
- **Unique Name**: Workflow name must be unique within the formation
- **Valid YAML**: Workflow body must contain valid YAML step configuration
- **Default Management**: Only one workflow per formation can be default
- **Version Control**: All workflow changes are tracked with commit messages

<Callout type="info" title="Permission Required">
You must have workflow create rights on the formation to create new workflows.
</Callout>

**Step Configuration:**
Each workflow consists of sequential steps with the following structure:
```yaml
steps:
  - name: step-name
    type: step_type
    config:
      # step-specific configuration
```

**Available Step Types:**
- **build_step**: Build containers and compile applications
- **test_step**: Execute test suites and quality checks
- **security_step**: Run security scans and vulnerability assessments
- **deploy_step**: Deploy applications with various strategies
- **script_step**: Execute custom scripts and commands
- **notification_step**: Send alerts and notifications

**Default Workflow Behavior:**
- Setting `default: true` makes this the formation's default workflow
- If another workflow is currently default, it will be unset automatically
- Default workflows are used when no specific workflow is specified in deployments

<ResponseCodes 
  codes={[200, 400, 401, 403, 422]}
  overrides={{
    200: "Success - Workflow created successfully",
    400: "Bad Request - Invalid workflow configuration or parameters",
    403: "Forbidden - OAuth token lacks required `redeploy` scope or insufficient workflow create rights",
    422: "Unprocessable Entity - Validation errors in workflow configuration"
  }}
/>